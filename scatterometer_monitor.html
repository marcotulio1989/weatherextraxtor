
<!DOCTYPE html>
<html>
<head>
    <title>Scatterometer Monitor - Deepwater Aquila</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; padding: 0; 
            background: #0a0a0a; 
            font-family: 'Consolas', 'Monaco', monospace; 
            color: #e0e0e0; 
        }
        
        /* Layout Principal */
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* Painel Lateral */
        .sidebar {
            width: 380px;
            background: #111;
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 15px;
        }
        
        /* Mapa */
        #map { 
            flex: 1;
            height: 100vh;
        }
        
        /* Estilos do Painel */
        h1 {
            font-size: 16px;
            color: #00ffcc;
            border-bottom: 2px solid #00ffcc;
            padding-bottom: 10px;
            margin: 0 0 15px 0;
        }
        
        h2 {
            font-size: 13px;
            color: #ff9900;
            margin: 20px 0 10px 0;
            text-transform: uppercase;
        }
        
        .section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 12px;
            color: #00ffcc;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666;
        }
        
        .status-indicator.active { background: #00ff00; }
        .status-indicator.loading { background: #ffff00; animation: pulse 1s infinite; }
        .status-indicator.error { background: #ff0000; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Inputs */
        label {
            display: block;
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }
        
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 8px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            border-radius: 3px;
            font-family: inherit;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        input:focus {
            outline: none;
            border-color: #00ffcc;
        }
        
        button {
            padding: 8px 16px;
            background: #00ffcc;
            color: #000;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        button:hover {
            background: #00ddaa;
        }
        
        button.secondary {
            background: #444;
            color: #fff;
        }
        
        button.secondary:hover {
            background: #555;
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
        
        /* Log de Status */
        .log-area {
            background: #000;
            border: 1px solid #333;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            font-size: 11px;
            border-radius: 3px;
        }
        
        .log-entry {
            margin-bottom: 4px;
            padding-left: 10px;
            border-left: 2px solid #444;
        }
        
        .log-entry.info { border-left-color: #00ffcc; }
        .log-entry.success { border-left-color: #00ff00; }
        .log-entry.error { border-left-color: #ff0000; }
        .log-entry.warning { border-left-color: #ffff00; }
        
        /* Dados de Vento */
        .wind-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-box {
            background: #222;
            padding: 10px;
            text-align: center;
            border-radius: 3px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00ffcc;
        }
        
        .stat-label {
            font-size: 10px;
            color: #888;
            margin-top: 4px;
        }
        
        /* Legenda */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        /* Checkbox customizado */
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .checkbox-item input {
            width: 16px;
            height: 16px;
        }
        
        /* Fonte info */
        .source-info {
            font-size: 10px;
            color: #666;
            margin-top: 5px;
        }
        
        .source-info a {
            color: #00aaff;
        }
        
        /* Info Icon com Tooltip */
        .input-with-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-with-info input {
            flex: 1;
            margin-bottom: 0;
        }
        
        .info-icon {
            width: 20px;
            height: 20px;
            background: #0088ff;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            position: relative;
            flex-shrink: 0;
        }
        
        .info-icon:hover {
            background: #00aaff;
        }
        
        .info-tooltip {
            display: none;
            position: absolute;
            left: 30px;
            top: -10px;
            background: #222;
            border: 1px solid #00aaff;
            border-radius: 6px;
            padding: 12px;
            width: 280px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        
        .info-icon:hover .info-tooltip {
            display: block;
        }
        
        .info-tooltip h4 {
            color: #00ffcc;
            margin: 0 0 8px 0;
            font-size: 12px;
        }
        
        .info-tooltip p {
            color: #ccc;
            font-size: 11px;
            margin: 6px 0;
            line-height: 1.4;
        }
        
        .info-tooltip ol {
            color: #aaa;
            font-size: 11px;
            margin: 8px 0;
            padding-left: 16px;
            line-height: 1.6;
        }
        
        .info-tooltip a {
            color: #00aaff;
            text-decoration: underline;
        }
        
        .info-tooltip .highlight {
            background: #333;
            padding: 4px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #ffcc00;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- PAINEL LATERAL -->
    <div class="sidebar">
        <h1>üõ∞Ô∏è SCATTEROMETER MONITOR</h1>
        
        <!-- POSI√á√ÉO DO NAVIO -->
        <div class="section">
            <div class="section-title">
                <span class="status-indicator active"></span>
                POSI√á√ÉO: Deepwater Aquila
            </div>
            <div class="wind-stats">
                <div class="stat-box">
                    <div class="stat-value">-22.5¬∞</div>
                    <div class="stat-label">LATITUDE</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">-40.5¬∞</div>
                    <div class="stat-label">LONGITUDE</div>
                </div>
            </div>
        </div>
        
        <!-- ESTAT√çSTICAS DE VENTO -->
        <div class="section">
            <div class="section-title">
                <span class="status-indicator" id="wind-status"></span>
                DADOS DE VENTO
            </div>
            
            <!-- M√©dia Multi-Modelo com Pesos Din√¢micos -->
            <div style="background:#1a2a1a; border:1px solid #00aa00; border-radius:4px; padding:10px; margin-bottom:10px;">
                <div style="font-size:10px; color:#00ff00; margin-bottom:5px;">üåç M√âDIA PONDERADA (5 MODELOS)</div>
                <div style="display:flex; gap:10px; align-items:center;">
                    <div style="text-align:center;">
                        <div style="font-size:24px; font-weight:bold; color:#00ffcc;" id="avg-model-speed">--</div>
                        <div style="font-size:9px; color:#888;">Velocidade (kn)</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:24px; font-weight:bold; color:#00ffcc;" id="avg-model-dir">--</div>
                        <div style="font-size:9px; color:#888;">Dire√ß√£o (¬∞)</div>
                    </div>
                </div>
                
                <!-- Valores individuais dos modelos -->
                <div style="margin-top:8px; padding-top:8px; border-top:1px solid #333; font-size:9px;">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:3px;">
                        <div><span style="color:#4488ff;">GFS:</span> <span id="gfs-value">--</span> <span id="gfs-weight" style="color:#ffaa00;"></span></div>
                        <div><span style="color:#ff8844;">ECMWF:</span> <span id="ecmwf-value">--</span> <span id="ecmwf-weight" style="color:#ffaa00;"></span></div>
                        <div><span style="color:#44ff88;">ICON:</span> <span id="icon-value">--</span> <span id="icon-weight" style="color:#ffaa00;"></span></div>
                        <div><span style="color:#ff44ff;">MeteoFR:</span> <span id="meteofr-value">--</span> <span id="meteofr-weight" style="color:#ffaa00;"></span></div>
                        <div><span style="color:#ffff44;">JMA:</span> <span id="jma-value">--</span> <span id="jma-weight" style="color:#ffaa00;"></span></div>
                    </div>
                    <div style="margin-top:5px; font-size:9px; color:#666;" id="weight-reason">
                        Pesos iguais (sem hist√≥rico)
                    </div>
                </div>
            </div>
            
            <div class="wind-stats">
                <div class="stat-box">
                    <div class="stat-value" id="avg-wind">--</div>
                    <div class="stat-label">VENTO M√âDIO (kn)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="max-wind">--</div>
                    <div class="stat-label">VENTO M√ÅX (kn)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="data-points">--</div>
                    <div class="stat-label">PONTOS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="data-age">--</div>
                    <div class="stat-label">IDADE (h)</div>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background:#00ff00"></div> &lt;10 kn</div>
                <div class="legend-item"><div class="legend-color" style="background:#88ff00"></div> 10-15 kn</div>
                <div class="legend-item"><div class="legend-color" style="background:#ffff00"></div> 15-20 kn</div>
                <div class="legend-item"><div class="legend-color" style="background:#ff9900"></div> 20-25 kn</div>
                <div class="legend-item"><div class="legend-color" style="background:#ff0000"></div> 25-30 kn</div>
                <div class="legend-item"><div class="legend-color" style="background:#ff00ff"></div> &gt;30 kn</div>
            </div>
            <div style="margin-top:10px; font-size:10px; color:#888; border-top:1px solid #333; padding-top:8px;">
                <div>‚óÜ = Dado de Escater√¥metro (sat√©lite)</div>
                <div style="margin-top:4px;">Escater√¥metros: √≠cone maior com borda</div>
                <div>Open-Meteo: √≠cone menor (modelo)</div>
            </div>
        </div>
        
        <!-- FONTES DE DADOS -->
        <h2>üì° FONTES DE DADOS</h2>
        
        <!-- Open-Meteo (Background - Modelo) -->
        <div class="section" style="border-left: 3px solid #666;">
            <div class="section-title">
                <span class="status-indicator" id="openmeteo-status"></span>
                OPEN-METEO (Modelo)
            </div>
            <p class="source-info">‚úÖ GRATUITO - Dados de fundo, atualiza a cada 15 min</p>
            <p class="source-info">√çcones menores - Modelo num√©rico (n√£o sat√©lite)</p>
            <button onclick="fetchOpenMeteoData()">üîÑ Atualizar Open-Meteo</button>
            <button class="secondary" onclick="clearOpenMeteoData()">üóëÔ∏è Limpar</button>
        </div>
        
        <h2>üõ∞Ô∏è ESCATER√îMETROS (Sat√©lite)</h2>
        
        <!-- NOAA ERDDAP (Gratuito) -->
        <div class="section" style="border-left: 3px solid #00ffcc;">
            <div class="section-title">
                <span class="status-indicator" id="noaa-status"></span>
                NOAA ERDDAP (ASCAT)
            </div>
            <p class="source-info">‚úÖ GRATUITO - N√£o precisa de API Key</p>
            <p class="source-info">Sat√©lites: MetOp-A, B, C (ASCAT)</p>
            <button onclick="fetchNOAAData()">üîÑ Buscar NOAA</button>
        </div>
        
        <!-- Copernicus Marine -->
        <div class="section" style="border-left: 3px solid #00ffcc;">
            <div class="section-title">
                <span class="status-indicator" id="cmems-status"></span>
                COPERNICUS MARINE (CMEMS)
            </div>
            <p class="source-info">
                Registro: <a href="https://data.marine.copernicus.eu/register" target="_blank">Criar conta gr√°tis</a>
            </p>
            <label>Username:</label>
            <div class="input-with-info">
                <input type="text" id="cmems-user" placeholder="seu_usuario">
                <span class="info-icon">i
                    <div class="info-tooltip">
                        <h4>üìã Como obter credenciais Copernicus</h4>
                        <ol>
                            <li>Acesse <a href="https://data.marine.copernicus.eu/register" target="_blank">data.marine.copernicus.eu/register</a></li>
                            <li>Preencha o formul√°rio de registro (nome, email, pa√≠s)</li>
                            <li>Confirme seu email</li>
                            <li>Fa√ßa login no site</li>
                            <li>Use o <span class="highlight">mesmo username e senha</span> aqui</li>
                        </ol>
                        <p>‚è±Ô∏è Ativa√ß√£o: <strong>imediata</strong> ap√≥s confirma√ß√£o do email</p>
                        <p>üõ∞Ô∏è Dados: ASCAT Level 3/4, ventos oce√¢nicos globais</p>
                    </div>
                </span>
            </div>
            <label>Password:</label>
            <div class="input-with-info">
                <input type="password" id="cmems-pass" placeholder="sua_senha">
                <span class="info-icon">i
                    <div class="info-tooltip">
                        <h4>üîê Senha Copernicus</h4>
                        <p>Use a mesma senha que voc√™ criou no registro do Copernicus Marine Service.</p>
                        <p>üí° <strong>Dica:</strong> A senha √© salva apenas localmente no seu navegador (localStorage).</p>
                    </div>
                </span>
            </div>
            <button onclick="fetchCopernicusData()">üîÑ Buscar CMEMS</button>
            <button class="secondary" onclick="saveCmemsCredentials()">üíæ Salvar</button>
        </div>
        
        <!-- NASA Earthdata -->
        <div class="section" style="border-left: 3px solid #00ffcc;">
            <div class="section-title">
                <span class="status-indicator" id="nasa-status"></span>
                NASA EARTHDATA (CYGNSS)
            </div>
            <p class="source-info">
                Registro: <a href="https://urs.earthdata.nasa.gov/users/new" target="_blank">Criar conta gr√°tis</a>
            </p>
            <label>Username:</label>
            <div class="input-with-info">
                <input type="text" id="nasa-user" placeholder="seu_usuario">
                <span class="info-icon">i
                    <div class="info-tooltip">
                        <h4>üìã Como obter credenciais NASA Earthdata</h4>
                        <ol>
                            <li>Acesse <a href="https://urs.earthdata.nasa.gov/users/new" target="_blank">urs.earthdata.nasa.gov/users/new</a></li>
                            <li>Clique em <span class="highlight">Register</span></li>
                            <li>Preencha: username, email, nome, pa√≠s</li>
                            <li>Aceite os termos de uso</li>
                            <li>Confirme seu email</li>
                            <li>‚ö†Ô∏è <strong>Importante:</strong> Ap√≥s login, v√° em "Applications" ‚Üí "Authorized Apps" e autorize o acesso a dados</li>
                        </ol>
                        <p>‚è±Ô∏è Ativa√ß√£o: <strong>imediata</strong></p>
                        <p>üõ∞Ô∏è Dados: CYGNSS (8 sat√©lites), QuikSCAT, RapidScat</p>
                    </div>
                </span>
            </div>
            <label>Password:</label>
            <div class="input-with-info">
                <input type="password" id="nasa-pass" placeholder="sua_senha">
                <span class="info-icon">i
                    <div class="info-tooltip">
                        <h4>üîê Senha NASA Earthdata</h4>
                        <p>Use a mesma senha que voc√™ criou no registro do NASA Earthdata.</p>
                        <p>üí° <strong>Requisitos da senha:</strong></p>
                        <p>‚Ä¢ M√≠nimo 8 caracteres<br>‚Ä¢ 1 letra mai√∫scula<br>‚Ä¢ 1 n√∫mero<br>‚Ä¢ 1 caractere especial</p>
                    </div>
                </span>
            </div>
            <button onclick="fetchNASAData()">üîÑ Buscar NASA</button>
            <button class="secondary" onclick="saveNasaCredentials()">üíæ Salvar</button>
        </div>
        
        <!-- Camadas do Mapa -->
        <h2>üó∫Ô∏è CAMADAS</h2>
        <div class="section">
            <div class="checkbox-group">
                <label class="checkbox-item">
                    <input type="checkbox" id="layer-arrows" checked onchange="toggleLayer('arrows')">
                    Setas de Vento
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="layer-satellite" checked onchange="toggleLayer('satellite')">
                    Sat√©lite (NASA GIBS)
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="layer-grid" onchange="toggleLayer('grid')">
                    Grade de Coordenadas
                </label>
            </div>
        </div>
        
        <!-- Log -->
        <h2>üìã LOG</h2>
        <div class="log-area" id="log-area">
            <div class="log-entry info">Sistema iniciado...</div>
        </div>
        
        <!-- A√ß√µes -->
        <div style="margin-top: 15px;">
            <button onclick="fetchAllSources()">üîÑ BUSCAR TODOS</button>
            <button class="secondary" onclick="clearData()">üóëÔ∏è Limpar</button>
            <button class="secondary" onclick="exportData()">üì• Exportar CSV</button>
        </div>
        
    </div>
    
    <!-- MAPA -->
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // =========================================================================
    // CONFIGURA√á√ÉO
    // =========================================================================
    // 100 NM = ~185 km = ~1.85 graus
    const RAIO_NM = 100;  // Raio em milhas n√°uticas
    const RAIO_GRAUS = RAIO_NM / 60;  // 1 grau = 60 NM
    
    const CONFIG = {
        shipLat: -22.5,
        shipLon: -40.5,
        latMin: -22.5 - RAIO_GRAUS,
        latMax: -22.5 + RAIO_GRAUS,
        lonMin: -40.5 - RAIO_GRAUS,
        lonMax: -40.5 + RAIO_GRAUS,
        shipName: "Deepwater Aquila"
    };
    
    let map;
    let windDataPoints = [];  // Armazena todos os dados de vento
    let windLayerGroup;
    let satelliteLayer;
    let gridLayer;
    
    // =========================================================================
    // INICIALIZA√á√ÉO DO MAPA
    // =========================================================================
    function initMap() {
        map = L.map('map', {
            center: [CONFIG.shipLat, CONFIG.shipLon],
            zoom: 7,
            zoomControl: false
        });

        L.control.zoom({ position: 'topright' }).addTo(map);
        L.control.scale({ position: 'bottomright', imperial: false }).addTo(map);

        // Mapa Base Escuro
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19
        }).addTo(map);
        
        // Camada de sat√©lite
        updateSatelliteLayer();
        
        // Grupos de camadas
        windLayerGroup = L.layerGroup().addTo(map);
        gridLayer = L.layerGroup();

        // √çcone do Navio
        const shipIcon = L.divIcon({
            className: 'ship-icon',
            html: `<svg viewBox="0 0 24 24" width="50" height="50">
                <circle cx="12" cy="12" r="10" fill="rgba(0,255,204,0.3)" stroke="#00ffcc" stroke-width="2"/>
                <circle cx="12" cy="12" r="4" fill="#00ffcc"/>
            </svg>`,
            iconSize: [50, 50],
            iconAnchor: [25, 25]
        });
        L.marker([CONFIG.shipLat, CONFIG.shipLon], { icon: shipIcon })
            .bindPopup(`<b>${CONFIG.shipName}</b><br>Lat: ${CONFIG.shipLat}<br>Lon: ${CONFIG.shipLon}`)
            .addTo(map);
        
        // √Årea de interesse (ret√¢ngulo)
        L.rectangle([[CONFIG.latMin, CONFIG.lonMin], [CONFIG.latMax, CONFIG.lonMax]], {
            color: "#00ffcc",
            weight: 1,
            fillOpacity: 0.05,
            dashArray: '5, 5'
        }).addTo(map);
        
        // Criar grade
        createGrid();
        
        // Carregar credenciais salvas
        loadSavedCredentials();
        
        log('info', 'Mapa inicializado');
        log('info', `√Årea: ${CONFIG.latMin.toFixed(2)}¬∞ a ${CONFIG.latMax.toFixed(2)}¬∞ lat (100 NM)`);
        
        // Buscar dados Open-Meteo automaticamente
        setTimeout(() => fetchOpenMeteoData(), 1000);
        
        // Atualiza√ß√£o autom√°tica do Open-Meteo a cada 15 minutos
        setInterval(() => {
            log('info', '‚è∞ Atualiza√ß√£o autom√°tica (15 min)...');
            fetchOpenMeteoData();
        }, 15 * 60 * 1000);  // 15 minutos
    }
    
    // =========================================================================
    // CAMADA DE SAT√âLITE (NASA GIBS)
    // =========================================================================
    function updateSatelliteLayer() {
        const now = new Date();
        const year = now.getUTCFullYear();
        const month = String(now.getUTCMonth() + 1).padStart(2, '0');
        const day = String(now.getUTCDate()).padStart(2, '0');
        const dateStr = `${year}-${month}-${day}`;

        if (satelliteLayer) {
            map.removeLayer(satelliteLayer);
        }

        const url = `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/GOES-East_ABI_Band13_Clean_Infrared/default/${dateStr}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`;

        satelliteLayer = L.tileLayer(url, {
            opacity: 0.5,
            zIndex: 1
        }).addTo(map);
    }
    
    // =========================================================================
    // GRADE DE COORDENADAS
    // =========================================================================
    function createGrid() {
        for (let lat = -30; lat <= -15; lat += 1) {
            L.polyline([[lat, CONFIG.lonMin - 2], [lat, CONFIG.lonMax + 2]], {
                color: '#333',
                weight: 1,
                opacity: 0.5
            }).addTo(gridLayer);
            
            L.marker([lat, CONFIG.lonMin - 1], {
                icon: L.divIcon({
                    className: 'grid-label',
                    html: `<span style="color:#666;font-size:10px">${lat}¬∞</span>`
                })
            }).addTo(gridLayer);
        }
        
        for (let lon = -50; lon <= -35; lon += 1) {
            L.polyline([[CONFIG.latMin - 2, lon], [CONFIG.latMax + 2, lon]], {
                color: '#333',
                weight: 1,
                opacity: 0.5
            }).addTo(gridLayer);
        }
    }
    
    // =========================================================================
    // TOGGLE DE CAMADAS
    // =========================================================================
    function toggleLayer(layer) {
        const checkbox = document.getElementById(`layer-${layer}`);
        switch(layer) {
            case 'arrows':
                if (checkbox.checked) windLayerGroup.addTo(map);
                else map.removeLayer(windLayerGroup);
                break;
            case 'satellite':
                if (checkbox.checked) satelliteLayer.addTo(map);
                else map.removeLayer(satelliteLayer);
                break;
            case 'grid':
                if (checkbox.checked) gridLayer.addTo(map);
                else map.removeLayer(gridLayer);
                break;
        }
    }
    
    // =========================================================================
    // BUSCAR DADOS - NOAA ERDDAP (GRATUITO!)
    // =========================================================================
    async function fetchNOAAData() {
        setStatus('noaa-status', 'loading');
        log('info', 'Buscando dados NOAA ERDDAP (ASCAT)...');
        
        // NOAA ERDDAP tem v√°rios datasets de escater√¥metro
        // Este √© o ASCAT L2 25km (MetOp)
        const baseUrl = 'https://coastwatch.pfeg.noaa.gov/erddap/griddap';
        
        // Dataset: erdQAwind1day - ASCAT daily wind
        // Vamos tentar pegar dados das √∫ltimas 24 horas
        const now = new Date();
        const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
        
        const startTime = yesterday.toISOString().split('.')[0] + 'Z';
        const endTime = now.toISOString().split('.')[0] + 'Z';
        
        // Construir URL para dados de vento ASCAT
        // Formato: dataset.json?variavel[(time_start):(time_end)][(lat_start):(lat_end)][(lon_start):(lon_end)]
        const url = `${baseUrl}/erdQAwind1day.json?` +
            `x_wind[(${startTime}):1:(${endTime})]` +
            `[(${CONFIG.latMax}):1:(${CONFIG.latMin})]` +
            `[(${CONFIG.lonMin}):1:(${CONFIG.lonMax})]` +
            `,y_wind[(${startTime}):1:(${endTime})]` +
            `[(${CONFIG.latMax}):1:(${CONFIG.latMin})]` +
            `[(${CONFIG.lonMin}):1:(${CONFIG.lonMax})]`;
        
        try {
            log('info', 'URL: ' + url.substring(0, 80) + '...');
            const response = await fetch(url);
            
            if (!response.ok) {
                log('warning', 'Dataset NOAA indispon√≠vel (status: ' + response.status + ')');
                setStatus('noaa-status', 'error');
                return;
            }
            
            const data = await response.json();
            processNOAAData(data);
            setStatus('noaa-status', 'active');
            
        } catch (error) {
            log('error', 'Erro NOAA/Escater√¥metro: ' + error.message);
            setStatus('noaa-status', 'error');
        }
    }
    
    // =========================================================================
    // OPEN-METEO (MULTI-MODELO) COM PESOS DIN√ÇMICOS
    // =========================================================================
    
    // Lista de modelos dispon√≠veis
    const MODELS = ['gfs_seamless', 'ecmwf_ifs025', 'icon_seamless', 'meteofrance_seamless', 'jma_seamless'];
    const MODEL_NAMES = {
        'gfs_seamless': 'GFS',
        'ecmwf_ifs025': 'ECMWF', 
        'icon_seamless': 'ICON',
        'meteofrance_seamless': 'MeteoFR',
        'jma_seamless': 'JMA'
    };
    
    // Armazena dados de todos os modelos
    let modelData = {};
    MODELS.forEach(m => modelData[m] = { speed: null, direction: null });
    
    // Pesos din√¢micos (iniciam iguais)
    let modelWeights = {};
    MODELS.forEach(m => modelWeights[m] = 1 / MODELS.length);
    
    // Hist√≥rico de previs√µes para compara√ß√£o
    let forecastHistory = [];
    
    // Carregar hist√≥rico do localStorage
    function loadForecastHistory() {
        try {
            const saved = localStorage.getItem('forecastHistoryMulti');
            if (saved) {
                forecastHistory = JSON.parse(saved);
                const cutoff = Date.now() - 24 * 60 * 60 * 1000;
                forecastHistory = forecastHistory.filter(h => h.timestamp > cutoff);
                log('info', `üìä Hist√≥rico carregado: ${forecastHistory.length} registros`);
                calculateDynamicWeights();
            }
        } catch (e) {
            forecastHistory = [];
        }
    }
    
    function saveForecastHistory() {
        try {
            localStorage.setItem('forecastHistoryMulti', JSON.stringify(forecastHistory));
        } catch (e) {}
    }
    
    function directionError(predicted, actual) {
        if (predicted === null || actual === null) return 180;
        let diff = Math.abs(predicted - actual);
        if (diff > 180) diff = 360 - diff;
        return diff;
    }
    
    // Calcular pesos baseado no erro hist√≥rico de TODOS os modelos
    function calculateDynamicWeights() {
        if (forecastHistory.length < 2) {
            MODELS.forEach(m => modelWeights[m] = 1 / MODELS.length);
            document.getElementById('weight-reason').textContent = 'Pesos iguais (hist√≥rico insuficiente)';
            return;
        }
        
        let modelErrors = {};
        MODELS.forEach(m => modelErrors[m] = 0);
        let comparisons = 0;
        
        for (let i = 1; i < forecastHistory.length; i++) {
            const prev = forecastHistory[i - 1];
            const curr = forecastHistory[i];
            
            MODELS.forEach(model => {
                if (prev[model] && curr[model] && prev[model].speed !== null && curr[model].speed !== null) {
                    const speedErr = Math.abs(prev[model].speed - curr[model].speed) / 20;
                    const dirErr = directionError(prev[model].direction, curr[model].direction) / 180;
                    modelErrors[model] += (speedErr + dirErr) / 2;
                }
            });
            comparisons++;
        }
        
        if (comparisons === 0) {
            MODELS.forEach(m => modelWeights[m] = 1 / MODELS.length);
            return;
        }
        
        // Normalizar erros
        MODELS.forEach(m => modelErrors[m] /= comparisons);
        
        // Converter erros em pesos (menor erro = maior peso)
        let totalInvError = 0;
        MODELS.forEach(m => {
            const invErr = 1 / (modelErrors[m] + 0.01); // +0.01 para evitar divis√£o por zero
            modelWeights[m] = invErr;
            totalInvError += invErr;
        });
        
        // Normalizar pesos
        MODELS.forEach(m => modelWeights[m] /= totalInvError);
        
        // Limitar entre 5% e 40%
        MODELS.forEach(m => {
            modelWeights[m] = Math.max(0.05, Math.min(0.40, modelWeights[m]));
        });
        
        // Renormalizar
        let sum = 0;
        MODELS.forEach(m => sum += modelWeights[m]);
        MODELS.forEach(m => modelWeights[m] /= sum);
        
        // Encontrar melhor modelo
        let bestModel = MODELS[0];
        let lowestError = modelErrors[MODELS[0]];
        MODELS.forEach(m => {
            if (modelErrors[m] < lowestError) {
                lowestError = modelErrors[m];
                bestModel = m;
            }
        });
        
        document.getElementById('weight-reason').innerHTML = 
            `‚öñÔ∏è ${comparisons} compara√ß√µes | Melhor: <span style="color:#00ff00;">${MODEL_NAMES[bestModel]}</span>`;
        
        log('info', `‚öñÔ∏è Pesos: ${MODELS.map(m => MODEL_NAMES[m] + ':' + (modelWeights[m]*100).toFixed(0) + '%').join(' | ')}`);
    }
    
    function addToForecastHistory(data) {
        const record = { timestamp: Date.now() };
        MODELS.forEach(m => {
            record[m] = data[m] ? { speed: data[m].speed, direction: data[m].direction } : { speed: null, direction: null };
        });
        
        forecastHistory.push(record);
        if (forecastHistory.length > 96) forecastHistory = forecastHistory.slice(-96);
        
        saveForecastHistory();
        calculateDynamicWeights();
    }
    
    async function fetchOpenMeteoData() {
        setStatus('openmeteo-status', 'loading');
        log('info', 'üåê Buscando 5 modelos (Open-Meteo)...');
        
        try {
            if (forecastHistory.length === 0) loadForecastHistory();
            
            // Limpar dados anteriores
            windDataPoints = windDataPoints.filter(p => 
                !p.source.includes('GFS') && !p.source.includes('ECMWF') && 
                !p.source.includes('ICON') && !p.source.includes('MeteoFR') && 
                !p.source.includes('JMA') && p.source !== 'Open-Meteo'
            );
            
            // Buscar cada modelo separadamente (mais confi√°vel)
            const modelUrls = {
                'gfs_seamless': 'https://api.open-meteo.com/v1/gfs?',
                'ecmwf_ifs025': 'https://api.open-meteo.com/v1/ecmwf?',
                'icon_seamless': 'https://api.open-meteo.com/v1/dwd-icon?',
                'meteofrance_seamless': 'https://api.open-meteo.com/v1/meteofrance?',
                'jma_seamless': 'https://api.open-meteo.com/v1/jma?'
            };
            
            const promises = MODELS.map(async model => {
                try {
                    const baseUrl = modelUrls[model] || 'https://api.open-meteo.com/v1/forecast?';
                    const url = `${baseUrl}latitude=${CONFIG.shipLat}&longitude=${CONFIG.shipLon}&current=wind_speed_10m,wind_direction_10m&wind_speed_unit=kn`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.current) {
                        modelData[model] = {
                            speed: data.current.wind_speed_10m,
                            direction: data.current.wind_direction_10m
                        };
                        log('info', `  ‚úì ${MODEL_NAMES[model]}: ${data.current.wind_speed_10m.toFixed(1)} kn`);
                    }
                } catch (e) {
                    log('warning', `  ‚úó ${MODEL_NAMES[model]}: erro`);
                }
            });
            
            await Promise.all(promises);
            
            // Adicionar ao hist√≥rico
            addToForecastHistory(modelData);
            
            // Atualizar display
            updateModelAverage();
            
            // Criar grid de pontos para o mapa (usando m√©dia ponderada)
            await fetchGridPoints();
            
            updateWindDisplay();
            setStatus('openmeteo-status', 'active');
            
            const activeModels = MODELS.filter(m => modelData[m].speed !== null).length;
            log('success', `‚úÖ ${activeModels} modelos carregados - Pr√≥xima atualiza√ß√£o em 15 min`);
            
        } catch (error) {
            log('error', '‚ùå Erro: ' + error.message);
            setStatus('openmeteo-status', 'error');
        }
    }
    
    async function fetchGridPoints() {
        const lats = [];
        const lons = [];
        const step = 0.2;  // Grid mais denso (triplicado)
        
        for (let la = CONFIG.latMin; la <= CONFIG.latMax; la += step) {
            lats.push(la.toFixed(2));
        }
        for (let lo = CONFIG.lonMin; lo <= CONFIG.lonMax; lo += step) {
            lons.push(lo.toFixed(2));
        }
        
        let queryLats = [];
        let queryLons = [];
        
        lats.forEach(la => {
            lons.forEach(lo => {
                queryLats.push(la);
                queryLons.push(lo);
            });
        });
        
        // Usar forecast API com modelo padr√£o para o grid
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${queryLats.join(',')}&longitude=${queryLons.join(',')}&current=wind_speed_10m,wind_direction_10m&wind_speed_unit=kn`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (Array.isArray(data)) {
            data.forEach(point => {
                if (point.current) {
                    addWindPoint({
                        lat: point.latitude,
                        lon: point.longitude,
                        speed: point.current.wind_speed_10m,
                        direction: point.current.wind_direction_10m,
                        time: new Date(),
                        source: 'Modelo (Open-Meteo)'
                    });
                }
            });
        } else if (data.current) {
            addWindPoint({
                lat: data.latitude,
                lon: data.longitude,
                speed: data.current.wind_speed_10m,
                direction: data.current.wind_direction_10m,
                time: new Date(),
                source: 'Modelo (Open-Meteo)'
            });
        }
    }
    
    function updateModelAverage() {
        // Atualizar valores individuais na UI
        const uiMap = {
            'gfs_seamless': 'gfs',
            'ecmwf_ifs025': 'ecmwf',
            'icon_seamless': 'icon',
            'meteofrance_seamless': 'meteofr',
            'jma_seamless': 'jma'
        };
        
        let validModels = 0;
        let weightedSpeed = 0;
        let weightedDirX = 0;
        let weightedDirY = 0;
        
        MODELS.forEach(model => {
            const uiKey = uiMap[model];
            const data = modelData[model];
            const weight = modelWeights[model];
            
            // Atualizar UI
            const valEl = document.getElementById(`${uiKey}-value`);
            const weightEl = document.getElementById(`${uiKey}-weight`);
            
            if (data && data.speed !== null) {
                valEl.textContent = `${data.speed.toFixed(1)} kn / ${data.direction.toFixed(0)}¬∞`;
                weightEl.textContent = `(${(weight * 100).toFixed(0)}%)`;
                
                // Acumular para m√©dia ponderada
                weightedSpeed += data.speed * weight;
                const rad = data.direction * Math.PI / 180;
                weightedDirX += Math.cos(rad) * weight;
                weightedDirY += Math.sin(rad) * weight;
                validModels++;
            } else {
                valEl.textContent = '--';
                weightEl.textContent = '';
            }
        });
        
        // Calcular m√©dia ponderada
        if (validModels > 0) {
            let avgDir = Math.atan2(weightedDirY, weightedDirX) * 180 / Math.PI;
            if (avgDir < 0) avgDir += 360;
            
            document.getElementById('avg-model-speed').textContent = weightedSpeed.toFixed(1);
            document.getElementById('avg-model-dir').textContent = avgDir.toFixed(0) + '¬∞';
            
            log('info', `üåç M√©dia Ponderada (${validModels} modelos): ${weightedSpeed.toFixed(1)} kn de ${avgDir.toFixed(0)}¬∞`);
        }
    }
    
    function clearOpenMeteoData() {
        windDataPoints = windDataPoints.filter(p => 
            !p.source.includes('GFS') && !p.source.includes('ECMWF') && 
            !p.source.includes('ICON') && !p.source.includes('Modelo') && 
            p.source !== 'Open-Meteo'
        );
        MODELS.forEach(m => modelData[m] = { speed: null, direction: null });
        document.getElementById('avg-model-speed').textContent = '--';
        document.getElementById('avg-model-dir').textContent = '--';
        updateWindDisplay();
        setStatus('openmeteo-status', '');
        log('info', 'üóëÔ∏è Dados de modelos removidos');
    }
    
    function processNOAAData(data) {
        if (!data.table || !data.table.rows) {
            log('warning', 'Dados NOAA vazios');
            return;
        }
        
        const rows = data.table.rows;
        let count = 0;
        
        rows.forEach(row => {
            // row = [time, lat, lon, x_wind, y_wind]
            const time = new Date(row[0]);
            const lat = row[1];
            const lon = row[2];
            const u = row[3];  // componente x
            const v = row[4];  // componente y
            
            if (u !== null && v !== null) {
                // Calcular velocidade e dire√ß√£o
                const speed = Math.sqrt(u*u + v*v) * 1.94384;  // m/s para knots
                const direction = (Math.atan2(-u, -v) * 180 / Math.PI + 360) % 360;
                
                addWindPoint({
                    lat: lat,
                    lon: lon,
                    speed: speed,
                    direction: direction,
                    time: time,
                    source: 'NOAA ASCAT'
                });
                count++;
            }
        });
        
        updateWindDisplay();
        log('success', `NOAA: ${count} pontos carregados`);
    }
    
    // =========================================================================
    // BUSCAR DADOS - COPERNICUS MARINE
    // =========================================================================
    async function fetchCopernicusData() {
        const user = document.getElementById('cmems-user').value;
        const pass = document.getElementById('cmems-pass').value;
        
        if (!user || !pass) {
            log('warning', 'CMEMS: Insira usu√°rio e senha');
            return;
        }
        
        setStatus('cmems-status', 'loading');
        log('info', 'Buscando dados Copernicus Marine...');
        
        // CMEMS usa WMS/WCS - precisamos de uma abordagem diferente
        // Para uso real, seria necess√°rio usar o copernicusmarine Python client
        // Aqui vamos mostrar como seria a URL
        
        const datasetId = 'WIND_GLO_PHY_L4_NRT_012_004';  // Global wind L4
        
        log('info', `Dataset: ${datasetId}`);
        log('warning', 'CMEMS requer autentica√ß√£o OAuth - use o Python client');
        log('info', 'Comando: pip install copernicusmarine');
        log('info', 'copernicusmarine subset -i ' + datasetId);
        
        // Mostrar instru√ß√µes
        alert(`Para acessar dados Copernicus Marine:

1. Instale o cliente Python:
   pip install copernicusmarine

2. Configure credenciais:
   copernicusmarine login

3. Baixe dados de vento:
   copernicusmarine subset \
     --dataset-id WIND_GLO_PHY_L4_NRT_012_004 \
     --variable eastward_wind \
     --variable northward_wind \
     --minimum-longitude ${CONFIG.lonMin} \
     --maximum-longitude ${CONFIG.lonMax} \
     --minimum-latitude ${CONFIG.latMin} \
     --maximum-latitude ${CONFIG.latMax}`);
        
        setStatus('cmems-status', 'error');
    }
    
    // =========================================================================
    // BUSCAR DADOS - NASA EARTHDATA
    // =========================================================================
    async function fetchNASAData() {
        const user = document.getElementById('nasa-user').value;
        const pass = document.getElementById('nasa-pass').value;
        
        if (!user || !pass) {
            log('warning', 'NASA: Insira usu√°rio e senha');
            return;
        }
        
        setStatus('nasa-status', 'loading');
        log('info', 'Buscando dados NASA Earthdata (CYGNSS)...');
        
        // NASA Earthdata tamb√©m requer autentica√ß√£o especial
        // CYGNSS √© um constela√ß√£o de 8 sat√©lites que mede vento oce√¢nico
        
        log('info', 'Datasets dispon√≠veis:');
        log('info', '- CYGNSS L2 Ocean Surface Wind Speed');
        log('info', '- QuikSCAT Level 2B (hist√≥rico)');
        log('info', '- RapidSCAT Level 2B (hist√≥rico)');
        
        log('warning', 'NASA Earthdata requer token de autentica√ß√£o');
        log('info', 'Use: https://search.earthdata.nasa.gov');
        
        setStatus('nasa-status', 'error');
    }
    
    // =========================================================================
    // FUN√á√ïES DE VISUALIZA√á√ÉO
    // =========================================================================
    function addWindPoint(point) {
        windDataPoints.push(point);
    }
    
    function updateWindDisplay() {
        windLayerGroup.clearLayers();
        
        if (windDataPoints.length === 0) return;
        
        let totalSpeed = 0;
        let maxSpeed = 0;
        let latestTime = new Date(0);
        
        windDataPoints.forEach(point => {
            // Desenhar seta
            drawWindArrow(point.lat, point.lon, point.direction, point.speed, point.source);
            
            // Estat√≠sticas
            totalSpeed += point.speed;
            if (point.speed > maxSpeed) maxSpeed = point.speed;
            if (point.time > latestTime) latestTime = point.time;
        });
        
        // Atualizar painel
        const avgSpeed = totalSpeed / windDataPoints.length;
        const ageHours = (new Date() - latestTime) / (1000 * 60 * 60);
        
        document.getElementById('avg-wind').textContent = avgSpeed.toFixed(1);
        document.getElementById('max-wind').textContent = maxSpeed.toFixed(1);
        document.getElementById('data-points').textContent = windDataPoints.length;
        document.getElementById('data-age').textContent = ageHours.toFixed(1);
        
        setStatus('wind-status', 'active');
    }
    
    function drawWindArrow(lat, lon, direction, speed, source) {
        // Cor baseada na velocidade
        let color;
        if (speed < 10) color = '#00ff00';
        else if (speed < 15) color = '#88ff00';
        else if (speed < 20) color = '#ffff00';
        else if (speed < 25) color = '#ff9900';
        else if (speed < 30) color = '#ff0000';
        else color = '#ff00ff';
        
        // ESCATER√îMETROS: √≠cone maior, borda destacada, zIndex alto
        const isScatterometer = source.includes('ASCAT') || source.includes('NOAA') || 
                                source.includes('CYGNSS') || source.includes('Copernicus') ||
                                source.includes('Scatterometer');
        
        const size = isScatterometer ? 36 : 22;
        const fontSize = isScatterometer ? '11px' : '9px';
        const borderStyle = isScatterometer ? `border: 2px solid ${color}; border-radius: 50%; background: rgba(0,0,0,0.7); padding: 3px;` : '';
        const zIndex = isScatterometer ? 1000 : 100;
        
        // DIRE√á√ÉO: Valor indica DE ONDE o vento vem (conven√ß√£o meteorol√≥gica)
        // Seta aponta PARA ONDE o vento vai (rota√ß√£o +180¬∞)
        // Ex: Vento de 0¬∞ (Norte) -> seta aponta para Sul (180¬∞)
        const arrowRotation = (direction + 180) % 360;  // Rotaciona 180¬∞
        
        const arrowHtml = `
            <div style="${borderStyle} transform: rotate(${arrowRotation}deg); width: ${size}px; height: ${size}px; display: flex; align-items: center; justify-content: center;">
                <svg viewBox="0 0 24 24" width="${size - 8}" height="${size - 8}">
                    <path fill="${color}" stroke="${isScatterometer ? '#fff' : 'none'}" stroke-width="${isScatterometer ? 1 : 0}" d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/>
                </svg>
            </div>
            <div style="text-align:center; font-size:${fontSize}; font-weight:bold; color:${color}; text-shadow: 1px 1px 2px black;">
                ${speed.toFixed(0)}${isScatterometer ? '‚óÜ' : ''}
            </div>
        `;

        const icon = L.divIcon({
            className: 'wind-arrow' + (isScatterometer ? ' scatterometer' : ' openmeteo'),
            html: arrowHtml,
            iconSize: [size, size + 12],
            iconAnchor: [size/2, (size + 12)/2]
        });

        L.marker([lat, lon], { icon: icon, zIndexOffset: zIndex })
            .bindPopup(`
                <b>Dados de Vento</b><br>
                Velocidade: ${speed.toFixed(1)} kn<br>
                Dire√ß√£o: ${direction.toFixed(0)}¬∞<br>
                Fonte: ${source}<br>
                Lat: ${lat.toFixed(3)}<br>
                Lon: ${lon.toFixed(3)}
            `)
            .addTo(windLayerGroup);
    }
    
    // =========================================================================
    // FUN√á√ïES AUXILIARES
    // =========================================================================
    function log(type, message) {
        const logArea = document.getElementById('log-area');
        const time = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.className = `log-entry ${type}`;
        entry.textContent = `[${time}] ${message}`;
        logArea.appendChild(entry);
        logArea.scrollTop = logArea.scrollHeight;
    }
    
    function setStatus(elementId, status) {
        const el = document.getElementById(elementId);
        if (el) {
            el.className = 'status-indicator ' + status;
        }
    }
    
    function saveCmemsCredentials() {
        const user = document.getElementById('cmems-user').value;
        const pass = document.getElementById('cmems-pass').value;
        localStorage.setItem('cmems-user', user);
        localStorage.setItem('cmems-pass', pass);
        log('success', 'Credenciais CMEMS salvas');
    }
    
    function saveNasaCredentials() {
        const user = document.getElementById('nasa-user').value;
        const pass = document.getElementById('nasa-pass').value;
        localStorage.setItem('nasa-user', user);
        localStorage.setItem('nasa-pass', pass);
        log('success', 'Credenciais NASA salvas');
    }
    
    function loadSavedCredentials() {
        document.getElementById('cmems-user').value = localStorage.getItem('cmems-user') || '';
        document.getElementById('cmems-pass').value = localStorage.getItem('cmems-pass') || '';
        document.getElementById('nasa-user').value = localStorage.getItem('nasa-user') || '';
        document.getElementById('nasa-pass').value = localStorage.getItem('nasa-pass') || '';
    }
    
    function fetchAllSources() {
        fetchNOAAData();
        // fetchCopernicusData();  // Requer autentica√ß√£o especial
        // fetchNASAData();  // Requer autentica√ß√£o especial
    }
    
    function clearData() {
        windDataPoints = [];
        windLayerGroup.clearLayers();
        document.getElementById('avg-wind').textContent = '--';
        document.getElementById('max-wind').textContent = '--';
        document.getElementById('data-points').textContent = '--';
        document.getElementById('data-age').textContent = '--';
        setStatus('wind-status', '');
        log('info', 'Dados limpos');
    }
    
    function exportData() {
        if (windDataPoints.length === 0) {
            log('warning', 'Nenhum dado para exportar');
            return;
        }
        
        let csv = 'latitude,longitude,wind_speed_kn,wind_direction,source,timestamp\n';
        windDataPoints.forEach(p => {
            csv += `${p.lat},${p.lon},${p.speed.toFixed(2)},${p.direction.toFixed(1)},${p.source},${p.time.toISOString()}\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `scatterometer_data_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
        
        log('success', 'Dados exportados para CSV');
    }
    
    // =========================================================================
    // INICIAR
    // =========================================================================
    initMap();
</script>

</body>
</html>
